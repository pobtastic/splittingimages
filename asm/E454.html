<!DOCTYPE html>
<html>
<head>
<title>Splitting Images: Routine at E454</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="E3F9.html">E3F9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#e454">Map</a></td>
<td class="next">
Next: <a href="E47B.html">E47B</a>
</td>
</tr>
</table>
<div class="description">E454: Controls: Down</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="E3F9.html">Controls_CheckLeft</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e454"></span>
<div class="comments">
<div class="paragraph">
Did the player press down?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Controls_CheckDown</td>
<td class="address-2"><span id="e454"></span>E454</td>
<td class="instruction">CP $04</td>
<td class="comment-1" rowspan="2">Jump to <a href="E47B.html">Controls_CheckUp</a> if the player didn't press down (04).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e456"></span>E456</td>
<td class="instruction">JR NZ,<a href="E47B.html">Controls_CheckUp</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e458"></span>
<div class="comments">
<div class="paragraph">
Down movement checks for boundaries and the home box.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MoveDown_Checks</td>
<td class="address-2"><span id="e458"></span>E458</td>
<td class="instruction">LD A,($D82C)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="D82C.html">DestinationCursor_Y_Position</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e45b"></span>
<div class="comments">
<div class="paragraph">
Can the player move down?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e45b"></span>E45B</td>
<td class="instruction">CP $0F</td>
<td class="comment-1" rowspan="2">If *<a href="D82C.html">DestinationCursor_Y_Position</a> is at or beyond the bottom-most boundary jump to <a href="E53C.html">Handler_CursorMovement</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e45d"></span>E45D</td>
<td class="instruction">JP P,<a href="E53C.html">Handler_CursorMovement</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e460"></span>
<div class="comments">
<div class="paragraph">
Is the player inside the home box?
</div>
<div class="paragraph">
The game restricts this (i.e. this image would never happen), but to demonstrate - this is position 02/ 02:   <table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="cursor-02-02" src="../images/scr/cursor-02-02.png" /></td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e460"></span>E460</td>
<td class="instruction">CP $02</td>
<td class="comment-1" rowspan="2">If *<a href="D82C.html">DestinationCursor_Y_Position</a> is not 02 (which confirms the player can't be inside the home box), jump to <a href="E454.html#e46f">MoveDown</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e462"></span>E462</td>
<td class="instruction">JR NZ,<a href="E454.html#e46f">MoveDown</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e464"></span>
<div class="comments">
<div class="paragraph">
If both the horizontal and the vertical co-ordinates are 02 then the player IS inside the home box. The outcome is different to left and right though - the home box can only be exited by moving right. So for this "down" action, we treat the bottom side of the home box as another boundary and don't allow the player to move through it.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e464"></span>E464</td>
<td class="instruction">LD A,($D82D)</td>
<td class="comment-1" rowspan="2">Now compare *<a href="D82C.html#d82d">DestinationCursor_X_Position</a> with 02.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e467"></span>E467</td>
<td class="instruction">CP $02</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e469"></span>E469</td>
<td class="instruction">JP Z,<a href="E53C.html">Handler_CursorMovement</a></td>
<td class="comment-1" rowspan="1">If *<a href="D82C.html#d82d">DestinationCursor_X_Position</a> is 02 (which confirms that yes, the player is inside the home box), jump to <a href="E53C.html">Handler_CursorMovement</a> to prevent the movement from happening.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e46c"></span>
<div class="comments">
<div class="paragraph">
Normal down movement.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e46c"></span>E46C</td>
<td class="instruction">LD A,($D82C)</td>
<td class="comment-1" rowspan="1">Reload *<a href="D82C.html">DestinationCursor_Y_Position</a> into <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label">MoveDown</td>
<td class="address-2"><span id="e46f"></span>E46F</td>
<td class="instruction">ADD A,$04</td>
<td class="comment-1" rowspan="1">Move 04 rows down.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e471"></span>E471</td>
<td class="instruction">LD ($D82C),A</td>
<td class="comment-1" rowspan="1">Update *<a href="D82C.html">DestinationCursor_Y_Position</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e474"></span>
<div class="comments">
<div class="paragraph">
Update the tile ID the player has now landed on.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e474"></span>E474</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="3">Add 07 to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e475"></span>E475</td>
<td class="instruction">ADD A,$07</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e477"></span>E477</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e478"></span>E478</td>
<td class="instruction">JP <a href="E53C.html">Handler_CursorMovement</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="E53C.html">Handler_CursorMovement</a>.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="E3F9.html">E3F9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#e454">Map</a></td>
<td class="next">
Next: <a href="E47B.html">E47B</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1986 Domark Ltd &copy; 2024 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.4.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/splittingimages/">Source code</a>.</div>
<div><a href="../dec/asm/58452.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>