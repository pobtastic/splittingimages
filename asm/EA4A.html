<!DOCTYPE html>
<html>
<head>
<title>Splitting Images: Routine at EA4A</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="EA2F.html">EA2F</a>
</td>
<td class="up">Up: <a href="../maps/all.html#ea4a">Map</a></td>
<td class="next">
Next: <a href="EB36.html">EB36</a>
</td>
</tr>
</table>
<div class="description">EA4A: Handler: Main Menu</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="D1D0.html">Game_Loop</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ea4a"></span>
<div class="comments">
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="main-menu-cursor" src="../images/scr/main-menu-cursor.png" /></td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_MainMenu</td>
<td class="address-2"><span id="ea4a"></span>EA4A</td>
<td class="instruction">LD DE,$D874</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="D874.html">Score_Digit_01</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea4d"></span>EA4D</td>
<td class="instruction">LD HL,$D86F</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="D86F.html">HighScore</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea50"></span>EA50</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Load the first byte of the current score.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea51"></span>EA51</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-1" rowspan="1">Compare it with the first byte of the high score.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea52"></span>EA52</td>
<td class="instruction">JP M,<a href="EA4A.html#ea62">Print_Score/HighScore</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="EA4A.html#ea62">Print_Score/HighScore</a> if the current score digit is less than the high score digit.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ea55"></span>
<div class="comments">
<div class="paragraph">
It's a new high score! Update what's stored.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea55"></span>EA55</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="2">Write the first score digit to the first highscore digit.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea56"></span>EA56</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea57"></span>EA57</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Increment the current score pointer by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea58"></span>EA58</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment the high score pointer by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea59"></span>EA59</td>
<td class="instruction">JR NZ,<a href="EA4A.html#ea60">UpdateHighScore</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="EA4A.html#ea60">UpdateHighScore</a> until the score digit is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea5b"></span>EA5B</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Load the second byte of the current score.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea5c"></span>EA5C</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-1" rowspan="1">Compare it with the second byte of the high score.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea5d"></span>EA5D</td>
<td class="instruction">JP M,<a href="EA4A.html#ea62">Print_Score/HighScore</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="EA4A.html#ea62">Print_Score/HighScore</a> if the current score digit is less than the high score digit.</td>
</tr>
<tr>
<td class="asm-label">UpdateHighScore</td>
<td class="address-2"><span id="ea60"></span>EA60</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="2">Write the second score digit to the second highscore digit.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea61"></span>EA61</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ea62"></span>
<div class="comments">
<div class="paragraph">
Print the score of the last game and the high score.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Print_Score/HighScore</td>
<td class="address-2"><span id="ea62"></span>EA62</td>
<td class="instruction">LD B,$13</td>
<td class="comment-1" rowspan="1">Set the X co-ordinate for the score display.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea64"></span>EA64</td>
<td class="instruction">LD C,$0E</td>
<td class="comment-1" rowspan="1">Set the Y co-ordinate for the score display.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea66"></span>EA66</td>
<td class="instruction">LD DE,$D874</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="D874.html">Score_Digit_01</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea69"></span>EA69</td>
<td class="instruction">LD A,$06</td>
<td class="comment-1" rowspan="1">Set the number of digits to print in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea6b"></span>EA6B</td>
<td class="instruction">CALL <a href="DB2E.html">Print_Numbers</a></td>
<td class="comment-1" rowspan="1">Call <a href="DB2E.html">Print_Numbers</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea6e"></span>EA6E</td>
<td class="instruction">LD B,$15</td>
<td class="comment-1" rowspan="1">Set the X co-ordinate for the high score display.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea70"></span>EA70</td>
<td class="instruction">LD C,$0E</td>
<td class="comment-1" rowspan="1">Set the Y co-ordinate for the high score display.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea72"></span>EA72</td>
<td class="instruction">LD DE,$D86F</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="D86F.html">HighScore</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea75"></span>EA75</td>
<td class="instruction">LD A,$06</td>
<td class="comment-1" rowspan="1">Set the number of digits to print in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea77"></span>EA77</td>
<td class="instruction">CALL <a href="DB2E.html">Print_Numbers</a></td>
<td class="comment-1" rowspan="1">Call <a href="DB2E.html">Print_Numbers</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ea7a"></span>
<div class="comments">
<div class="paragraph">
Initialise the cursor/ pointer which highlights the currently selected menu item.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea7a"></span>EA7A</td>
<td class="instruction">LD IX,($D877)</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=*<a href="D877.html">SelectedMenuItem_ScreenPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea7e"></span>EA7E</td>
<td class="instruction">LD HL,$EB38</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="EB38.html">SelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea81"></span>EA81</td>
<td class="instruction">JR <a href="EA4A.html#eae7">HighlightSelectedMenuItem</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="EA4A.html#eae7">HighlightSelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ea83"></span>
<div class="comments">
<div class="paragraph">
Maybe a debounce loop?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Debounce_Loop</td>
<td class="address-2"><span id="ea83"></span>EA83</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Get the player input from ALL half-rows (i.e. all the keys).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea84"></span>EA84</td>
<td class="instruction">IN A,($FE)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea86"></span>EA86</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="1">Invert the bits in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea87"></span>EA87</td>
<td class="instruction">AND %00011111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-4.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea89"></span>EA89</td>
<td class="instruction">JR NZ,<a href="EA4A.html#ea83">Debounce_Loop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="EA4A.html#ea83">Debounce_Loop</a> if <span class="register">HL</span> is not zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ea8b"></span>
<div class="comments">
<div class="paragraph">
Get the player input.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MainMenuInput_Loop</td>
<td class="address-2"><span id="ea8b"></span>EA8B</td>
<td class="instruction">LD A,$F7</td>
<td class="comment-1" rowspan="2">Read from the keyboard; <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">F7</td>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="centre" colspan="1" rowspan="1">5</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea8d"></span>EA8D</td>
<td class="instruction">IN A,($FE)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea8f"></span>EA8F</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="1">Invert the bits in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea90"></span>EA90</td>
<td class="instruction">AND %00011111</td>
<td class="comment-1" rowspan="1">Mask for the key bits.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea92"></span>EA92</td>
<td class="instruction">JR Z,<a href="EA4A.html#ea8b">MainMenuInput_Loop</a></td>
<td class="comment-1" rowspan="1">Jump back to <a href="EA4A.html#ea8b">MainMenuInput_Loop</a> if no keys are being pressed.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ea94"></span>
<div class="comments">
<div class="paragraph">
Check which key was pressed and handle accordingly.
</div>
<div class="paragraph">
Handle "KEYBOARD" being selected.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea94"></span>EA94</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="2">Jump to <a href="EA4A.html#eaa8">MainMenuInput_Kempston</a> if "1" was not pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea95"></span>EA95</td>
<td class="instruction">JR NC,<a href="EA4A.html#eaa8">MainMenuInput_Kempston</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea97"></span>EA97</td>
<td class="instruction">LD A,$01</td>
<td class="comment-1" rowspan="3">Jump back to <a href="EA4A.html#ea83">Debounce_Loop</a> if this menu item is already selected.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea99"></span>EA99</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea9a"></span>EA9A</td>
<td class="instruction">JR Z,<a href="EA4A.html#ea83">Debounce_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea9c"></span>EA9C</td>
<td class="instruction">CALL <a href="EA4A.html#eafd">ClearSelectedMenuItem</a></td>
<td class="comment-1" rowspan="1">Call <a href="EA4A.html#eafd">ClearSelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ea9f"></span>EA9F</td>
<td class="instruction">LD IX,$5843</td>
<td class="comment-1" rowspan="1">Set the screen position for this option in <span class="register">IX</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eaa3"></span>EAA3</td>
<td class="instruction">LD DE,$EB64</td>
<td class="comment-1" rowspan="1">Set the address of the input control routine for this option in <span class="register">DE</span> (<a href="EB64.html">InputHandler_Keyboard</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eaa6"></span>EAA6</td>
<td class="instruction">JR <a href="EA4A.html#eae2">UpdateMenuSelection</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="EA4A.html#eae2">UpdateMenuSelection</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="eaa8"></span>
<div class="comments">
<div class="paragraph">
Handle "KEMPSTON" being selected.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MainMenuInput_Kempston</td>
<td class="address-2"><span id="eaa8"></span>EAA8</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="2">Jump to <a href="EA4A.html#eabc">MainMenuInput_Cursor</a> if "2" was not pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eaa9"></span>EAA9</td>
<td class="instruction">JR NC,<a href="EA4A.html#eabc">MainMenuInput_Cursor</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eaab"></span>EAAB</td>
<td class="instruction">LD A,$02</td>
<td class="comment-1" rowspan="3">Jump back to <a href="EA4A.html#ea83">Debounce_Loop</a> if this menu item is already selected.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eaad"></span>EAAD</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eaae"></span>EAAE</td>
<td class="instruction">JR Z,<a href="EA4A.html#ea83">Debounce_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eab0"></span>EAB0</td>
<td class="instruction">CALL <a href="EA4A.html#eafd">ClearSelectedMenuItem</a></td>
<td class="comment-1" rowspan="1">Call <a href="EA4A.html#eafd">ClearSelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eab3"></span>EAB3</td>
<td class="instruction">LD IX,$58A3</td>
<td class="comment-1" rowspan="1">Set the screen position for this option in <span class="register">IX</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eab7"></span>EAB7</td>
<td class="instruction">LD DE,$EB98</td>
<td class="comment-1" rowspan="1">Set the address of the input control routine for this option in <span class="register">DE</span> (<a href="EB98.html">InputHandler_Kempston</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eaba"></span>EABA</td>
<td class="instruction">JR <a href="EA4A.html#eae2">UpdateMenuSelection</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="EA4A.html#eae2">UpdateMenuSelection</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="eabc"></span>
<div class="comments">
<div class="paragraph">
Handle "CURSOR" being selected.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MainMenuInput_Cursor</td>
<td class="address-2"><span id="eabc"></span>EABC</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="2">Jump to <a href="EA4A.html#ead0">MainMenuInput_Sinclair</a> if "3" was not pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eabd"></span>EABD</td>
<td class="instruction">JR NC,<a href="EA4A.html#ead0">MainMenuInput_Sinclair</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eabf"></span>EABF</td>
<td class="instruction">LD A,$03</td>
<td class="comment-1" rowspan="3">Jump back to <a href="EA4A.html#ea83">Debounce_Loop</a> if this menu item is already selected.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eac1"></span>EAC1</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eac2"></span>EAC2</td>
<td class="instruction">JR Z,<a href="EA4A.html#ea83">Debounce_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eac4"></span>EAC4</td>
<td class="instruction">CALL <a href="EA4A.html#eafd">ClearSelectedMenuItem</a></td>
<td class="comment-1" rowspan="1">Call <a href="EA4A.html#eafd">ClearSelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eac7"></span>EAC7</td>
<td class="instruction">LD IX,$5903</td>
<td class="comment-1" rowspan="1">Set the screen position for this option in <span class="register">IX</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eacb"></span>EACB</td>
<td class="instruction">LD DE,$EB9E</td>
<td class="comment-1" rowspan="1">Set the address of the input control routine for this option in <span class="register">DE</span> (<a href="EB9E.html">InputHandler_Cursor</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eace"></span>EACE</td>
<td class="instruction">JR <a href="EA4A.html#eae2">UpdateMenuSelection</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="EA4A.html#eae2">UpdateMenuSelection</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ead0"></span>
<div class="comments">
<div class="paragraph">
Handle "SINCLAIR" being selected.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MainMenuInput_Sinclair</td>
<td class="address-2"><span id="ead0"></span>EAD0</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="2">Jump to <a href="EA4A.html#eb0e">MainMenuInput_StartGame</a> if "4" was not pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ead1"></span>EAD1</td>
<td class="instruction">JR NC,<a href="EA4A.html#eb0e">MainMenuInput_StartGame</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ead3"></span>EAD3</td>
<td class="instruction">LD A,$04</td>
<td class="comment-1" rowspan="3">Jump back to <a href="EA4A.html#ea83">Debounce_Loop</a> if this menu item is already selected.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ead5"></span>EAD5</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ead6"></span>EAD6</td>
<td class="instruction">JR Z,<a href="EA4A.html#ea83">Debounce_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ead8"></span>EAD8</td>
<td class="instruction">CALL <a href="EA4A.html#eafd">ClearSelectedMenuItem</a></td>
<td class="comment-1" rowspan="1">Call <a href="EA4A.html#eafd">ClearSelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eadb"></span>EADB</td>
<td class="instruction">LD IX,$5963</td>
<td class="comment-1" rowspan="1">Set the screen position for this option in <span class="register">IX</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eadf"></span>EADF</td>
<td class="instruction">LD DE,$EBCD</td>
<td class="comment-1" rowspan="1">Set the address of the input control routine for this option in <span class="register">DE</span> (<a href="EBCD.html">InputHandler_Sinclair</a>).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="eae2"></span>
<div class="comments">
<div class="paragraph">
Update menu selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">UpdateMenuSelection</td>
<td class="address-2"><span id="eae2"></span>EAE2</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write the selected menu item to *<a href="EB38.html">SelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eae3"></span>EAE3</td>
<td class="instruction">LD ($EB36),DE</td>
<td class="comment-1" rowspan="1">Write the address of the input control routine to *<a href="EB36.html">Pointer_InputControl</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="eae7"></span>
<div class="comments">
<div class="paragraph">
Point to selected menu item.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">HighlightSelectedMenuItem</td>
<td class="address-2"><span id="eae7"></span>EAE7</td>
<td class="instruction">LD (IX+$00),$45</td>
<td class="comment-1" rowspan="2">Write INK:
CYAN,
PAPER:
BLACK
(BRIGHT)
 to: <table class="default">
<tr>
<th colspan="1" rowspan="1">Offset</th>
<th colspan="1" rowspan="1">Position</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+00</td>
<td class="centre" colspan="1" rowspan="1">Top-left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+01</td>
<td class="centre" colspan="1" rowspan="1">Top-right</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eaeb"></span>EAEB</td>
<td class="instruction">LD (IX+$01),$45</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eaef"></span>EAEF</td>
<td class="instruction">LD (IX+$20),$05</td>
<td class="comment-1" rowspan="2">Write INK:
CYAN,
PAPER:
BLACK

 to: <table class="default">
<tr>
<th colspan="1" rowspan="1">Offset</th>
<th colspan="1" rowspan="1">Position</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+20</td>
<td class="centre" colspan="1" rowspan="1">Bottom-left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+21</td>
<td class="centre" colspan="1" rowspan="1">Bottom-right</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eaf3"></span>EAF3</td>
<td class="instruction">LD (IX+$21),$05</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eaf7"></span>EAF7</td>
<td class="instruction">LD ($D877),IX</td>
<td class="comment-1" rowspan="1">Write <span class="register">IX</span> to <a href="D877.html">SelectedMenuItem_ScreenPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eafb"></span>EAFB</td>
<td class="instruction">JR <a href="EA4A.html#ea83">Debounce_Loop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="EA4A.html#ea83">Debounce_Loop</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="eafd"></span>
<div class="comments">
<div class="paragraph">
Clear previous selected menu item.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">ClearSelectedMenuItem</td>
<td class="address-2"><span id="eafd"></span>EAFD</td>
<td class="instruction">LD (IX+$00),$00</td>
<td class="comment-1" rowspan="4">Write INK:
BLACK,
PAPER:
BLACK

 to: <table class="default">
<tr>
<th colspan="1" rowspan="1">Offset</th>
<th colspan="1" rowspan="1">Position</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+00</td>
<td class="centre" colspan="1" rowspan="1">Top-left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+01</td>
<td class="centre" colspan="1" rowspan="1">Top-right</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+20</td>
<td class="centre" colspan="1" rowspan="1">Bottom-left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+21</td>
<td class="centre" colspan="1" rowspan="1">Bottom-right</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb01"></span>EB01</td>
<td class="instruction">LD (IX+$01),$00</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb05"></span>EB05</td>
<td class="instruction">LD (IX+$20),$00</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb09"></span>EB09</td>
<td class="instruction">LD (IX+$21),$00</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb0d"></span>EB0D</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="eb0e"></span>
<div class="comments">
<div class="paragraph">
Note; there's no need for the "not pressed" check, as there are only five options.
</div>
<div class="paragraph">
Handle "START GAME" being selected.
</div>
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="good-luck" src="../images/scr/good-luck.png" /></td>
</tr>
</table>
</div>
<div class="paragraph">
Uncover the "Good Luck" messaging (it's already present, just black on black).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MainMenuInput_StartGame</td>
<td class="address-2"><span id="eb0e"></span>EB0E</td>
<td class="instruction">LD HL,$5A36</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=5A36 (attribute buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb11"></span>EB11</td>
<td class="instruction">LD DE,$0020</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=0020.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb14"></span>EB14</td>
<td class="instruction">LD B,$04</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> for the number of rows to process.</td>
</tr>
<tr>
<td class="asm-label">GoodLuck_OuterLoop</td>
<td class="address-2"><span id="eb16"></span>EB16</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash the row counter on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb17"></span>EB17</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> for the width of the messaging.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb19"></span>EB19</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash the starting position in the attribute buffer on the stack.</td>
</tr>
<tr>
<td class="asm-label">GoodLuck_InnerLoop</td>
<td class="address-2"><span id="eb1a"></span>EB1A</td>
<td class="instruction">LD (HL),$47</td>
<td class="comment-1" rowspan="1">Write INK:
WHITE,
PAPER:
BLACK
(BRIGHT)
 to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb1c"></span>EB1C</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment attribute buffer screen position by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb1d"></span>EB1D</td>
<td class="instruction">DJNZ <a href="EA4A.html#eb1a">GoodLuck_InnerLoop</a></td>
<td class="comment-1" rowspan="1">Decrease width counter by one and loop back to <a href="EA4A.html#eb1a">GoodLuck_InnerLoop</a> until all the width has been coloured.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb1f"></span>EB1F</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the attribute buffer starting position from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb20"></span>EB20</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>+=0020 (move down one row).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb21"></span>EB21</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the row counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb22"></span>EB22</td>
<td class="instruction">DJNZ <a href="EA4A.html#eb16">GoodLuck_OuterLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the row counter by one and loop back to <a href="EA4A.html#eb16">GoodLuck_OuterLoop</a> until the row counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb24"></span>EB24</td>
<td class="instruction">LD HL,$EB39</td>
<td class="comment-1" rowspan="2">Write 01 to <a href="EB39.html">EB39</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb27"></span>EB27</td>
<td class="instruction">LD (HL),$01</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb29"></span>EB29</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash <a href="EB39.html">EB39</a> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb2a"></span>EB2A</td>
<td class="instruction">LD HL,$EB3A</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="EB3A.html">EB3A</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb2d"></span>EB2D</td>
<td class="instruction">LD B,$0E</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=0E.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb2f"></span>EB2F</td>
<td class="instruction">CALL <a href="EF4A.html">$EF4A</a></td>
<td class="comment-1" rowspan="1">Call <a href="EF4A.html">EF4A</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb32"></span>EB32</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb33"></span>EB33</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-1" rowspan="1">Write 00 to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="eb35"></span>EB35</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="EA2F.html">EA2F</a>
</td>
<td class="up">Up: <a href="../maps/all.html#ea4a">Map</a></td>
<td class="next">
Next: <a href="EB36.html">EB36</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1986 Domark Ltd &copy; 2024 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.4.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/splittingimages/">Source code</a>.</div>
<div><a href="../dec/asm/59978.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>