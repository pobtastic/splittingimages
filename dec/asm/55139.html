<!DOCTYPE html>
<html>
<head>
<title>Splitting Images: Routine at 55139</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="55052.html">55052</a>
</td>
<td class="up">Up: <a href="../maps/all.html#55139">Map</a></td>
<td class="next">
Next: <a href="55238.html">55238</a>
</td>
</tr>
</table>
<div class="description">55139: Handler: Bonus</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="54098.html">54098</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Bonus</td>
<td class="address-2"><span id="55139"></span>55139</td>
<td class="instruction">LD A,(59229)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="59229.html">Tile_Horizontal_Position</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55142"></span>55142</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">A</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55143"></span>55143</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55144"></span>55144</td>
<td class="instruction">LD A,(59230)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="59229.html#59230">Tile_Vertical_Position</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55147"></span>55147</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">A</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55148"></span>55148</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55149"></span>55149</td>
<td class="instruction">CALL <a href="56514.html">Calculate_ScreenBlockAddress</a></td>
<td class="comment-1" rowspan="1">Call <a href="56514.html">Calculate_ScreenBlockAddress</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55152"></span>55152</td>
<td class="instruction">CALL <a href="56529.html">Calculate_AttributeAddress</a></td>
<td class="comment-1" rowspan="1">Call <a href="56529.html">Calculate_AttributeAddress</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55155"></span>55155</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Stash <span class="register">DE</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55156"></span>55156</td>
<td class="instruction">LD IX,(55438)</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=*<a href="55438.html">55438</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55160"></span>55160</td>
<td class="instruction">LD DE,46949</td>
<td class="comment-1" rowspan="2"><span class="register">IX</span>+=<a href="46949.html">GraphicsData_Items_02</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55163"></span>55163</td>
<td class="instruction">ADD IX,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55165"></span>55165</td>
<td class="instruction">LD D,4</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">D</span> for 4 rows.</td>
</tr>
<tr>
<td class="asm-label">Handler_Bonus_0</td>
<td class="address-2"><span id="55167"></span>55167</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash the co-ordinates on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55168"></span>55168</td>
<td class="instruction">LD B,8</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> for 8 columns.</td>
</tr>
<tr>
<td class="asm-label">Handler_Bonus_1</td>
<td class="address-2"><span id="55170"></span>55170</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash the column counter on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55171"></span>55171</td>
<td class="instruction">LD B,4</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> for 4 bytes per character.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55173"></span>55173</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash the screen position on the stack.</td>
</tr>
<tr>
<td class="asm-label">Handler_Bonus_2</td>
<td class="address-2"><span id="55174"></span>55174</td>
<td class="instruction">LD A,(IX+0)</td>
<td class="comment-1" rowspan="2">Write a byte from the object data to the screen buffer position.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55177"></span>55177</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55178"></span>55178</td>
<td class="instruction">INC IX</td>
<td class="comment-1" rowspan="1">Increment the object data pointer by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55180"></span>55180</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment the screen position by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55181"></span>55181</td>
<td class="instruction">DJNZ <a href="55139.html#55174">Handler_Bonus_2</a></td>
<td class="comment-1" rowspan="1">Decrease the object byte counter by one and loop back to <a href="55139.html#55174">Handler_Bonus_2</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55183"></span>55183</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the original screen position for this row from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55184"></span>55184</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Increment <span class="register">H</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55185"></span>55185</td>
<td class="instruction">LD BC,16</td>
<td class="comment-1" rowspan="2"><span class="register">IX</span>+=0016.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55188"></span>55188</td>
<td class="instruction">ADD IX,BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55190"></span>55190</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the column counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55191"></span>55191</td>
<td class="instruction">DJNZ <a href="55139.html#55170">Handler_Bonus_1</a></td>
<td class="comment-1" rowspan="1">Decrease the column counter by one and loop back to <a href="55139.html#55170">Handler_Bonus_1</a> until the column counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55193"></span>55193</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the co-ordinates from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55194"></span>55194</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1">Increment <span class="register">B</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55195"></span>55195</td>
<td class="instruction">CALL <a href="56514.html">Calculate_ScreenBlockAddress</a></td>
<td class="comment-1" rowspan="1">Call <a href="56514.html">Calculate_ScreenBlockAddress</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55198"></span>55198</td>
<td class="instruction">DEC D</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">D</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55199"></span>55199</td>
<td class="instruction">JR NZ,<a href="55139.html#55167">Handler_Bonus_0</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="55139.html#55167">Handler_Bonus_0</a> if <span class="register">D</span> is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55201"></span>55201</td>
<td class="instruction">LD IX,(55440)</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=*<a href="55440.html">55440</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55205"></span>55205</td>
<td class="instruction">LD DE,46949</td>
<td class="comment-1" rowspan="2"><span class="register">IX</span>+=<a href="46949.html">GraphicsData_Items_02</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55208"></span>55208</td>
<td class="instruction">ADD IX,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55210"></span>55210</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55211"></span>55211</td>
<td class="instruction">LD B,4</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=4.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55213"></span>55213</td>
<td class="instruction">LD DE,28</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=0028.</td>
</tr>
<tr>
<td class="asm-label">Handler_Bonus_3</td>
<td class="address-2"><span id="55216"></span>55216</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash <span class="register">BC</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55217"></span>55217</td>
<td class="instruction">LD B,4</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=4.</td>
</tr>
<tr>
<td class="asm-label">Handler_Bonus_4</td>
<td class="address-2"><span id="55219"></span>55219</td>
<td class="instruction">LD A,(IX+0)</td>
<td class="comment-1" rowspan="2">Write *<span class="register">IX</span>+0 to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55222"></span>55222</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55223"></span>55223</td>
<td class="instruction">INC IX</td>
<td class="comment-1" rowspan="1">Increment <span class="register">IX</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55225"></span>55225</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment <span class="register">HL</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55226"></span>55226</td>
<td class="instruction">DJNZ <a href="55139.html#55219">Handler_Bonus_4</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="55139.html#55219">Handler_Bonus_4</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55228"></span>55228</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>+=<span class="register">DE</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55229"></span>55229</td>
<td class="instruction">LD BC,16</td>
<td class="comment-1" rowspan="2"><span class="register">IX</span>+=0016.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55232"></span>55232</td>
<td class="instruction">ADD IX,BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55234"></span>55234</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55235"></span>55235</td>
<td class="instruction">DJNZ <a href="55139.html#55216">Handler_Bonus_3</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="55139.html#55216">Handler_Bonus_3</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55237"></span>55237</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="55052.html">55052</a>
</td>
<td class="up">Up: <a href="../maps/all.html#55139">Map</a></td>
<td class="next">
Next: <a href="55238.html">55238</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1986 Domark Ltd &copy; 2024 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.4.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/splittingimages/">Source code</a>.</div>
<div><a href="../../asm/D763.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>