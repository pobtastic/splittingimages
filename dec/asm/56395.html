<!DOCTYPE html>
<html>
<head>
<title>Splitting Images: Routine at 56395</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="56293.html">56293</a>
</td>
<td class="up">Up: <a href="../maps/all.html#56395">Map</a></td>
<td class="next">
Next: <a href="56514.html">56514</a>
</td>
</tr>
</table>
<div class="description">56395: Move Tile Down</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="61025.html">61025</a> and <a href="62526.html">62526</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MoveTile_Down</td>
<td class="address-2"><span id="56395"></span>56395</td>
<td class="instruction">LD A,(59230)</td>
<td class="comment-1" rowspan="3">Take *<a href="59229.html#59230">Tile_Vertical_Position</a> and store it in <span class="register">A</span>. Decrease it by one, which adjusts the value for the tile height, and write this value to *<a href="59229.html#59232">Tile_Vertical_Coordinate</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56398"></span>56398</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56399"></span>56399</td>
<td class="instruction">LD (59232),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56402"></span>56402</td>
<td class="instruction">LD A,(59233)</td>
<td class="comment-1" rowspan="2">Load <span class="register">B</span> with *<a href="59229.html#59233">Tile_SpacesToMove</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56405"></span>56405</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="asm-label">MoveTile_Down_Loop</td>
<td class="address-2"><span id="56406"></span>56406</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash the row counter on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56407"></span>56407</td>
<td class="instruction">LD A,(59229)</td>
<td class="comment-1" rowspan="3">Take *<a href="59229.html">Tile_Horizontal_Position</a> and store it in <span class="register">A</span>. Add 2 which adjusts the value for the tile height, and write this value to *<a href="59229.html#59231">Tile_Horizontal_Coordinate</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56410"></span>56410</td>
<td class="instruction">ADD A,2</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56412"></span>56412</td>
<td class="instruction">LD (59231),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56415"></span>56415</td>
<td class="instruction">LD B,4</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> for the height of the tile in bytes (4).</td>
</tr>
<tr>
<td class="asm-label">MoveTile_Down_RowLoop</td>
<td class="address-2"><span id="56417"></span>56417</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash the row (tile height) counter on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56418"></span>56418</td>
<td class="instruction">LD A,(59231)</td>
<td class="comment-1" rowspan="2"><span class="register">B</span>=*<a href="59229.html#59231">Tile_Horizontal_Coordinate</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56421"></span>56421</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56422"></span>56422</td>
<td class="instruction">LD A,(59232)</td>
<td class="comment-1" rowspan="2"><span class="register">C</span>=*<a href="59229.html#59232">Tile_Vertical_Coordinate</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56425"></span>56425</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56426"></span>56426</td>
<td class="instruction">CALL <a href="56514.html">Calculate_ScreenBlockAddress</a></td>
<td class="comment-1" rowspan="1">Call <a href="56514.html">Calculate_ScreenBlockAddress</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56429"></span>56429</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash the destination screen buffer address on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56430"></span>56430</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1">Increment <span class="register">B</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56431"></span>56431</td>
<td class="instruction">CALL <a href="56514.html">Calculate_ScreenBlockAddress</a></td>
<td class="comment-1" rowspan="1">Call <a href="56514.html">Calculate_ScreenBlockAddress</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56434"></span>56434</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="2"><span class="register">DE</span>=screen buffer address of the tile (using the stack).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56435"></span>56435</td>
<td class="instruction">POP DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56436"></span>56436</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the destination screen buffer address from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56437"></span>56437</td>
<td class="instruction">LD A,8</td>
<td class="comment-1" rowspan="1">Load the number of pixels per row in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56439"></span>56439</td>
<td class="instruction">LD BC,4</td>
<td class="comment-1" rowspan="1">Set the count for the size of the tile in <span class="register">BC</span> (0004 character blocks).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56442"></span>56442</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash <span class="register">HL</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label">MoveTile_Down_PixelShift</td>
<td class="address-2"><span id="56443"></span>56443</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="2">Stash <span class="register">HL</span> and <span class="register">DE</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56444"></span>56444</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56445"></span>56445</td>
<td class="instruction">LDIR</td>
<td class="comment-1" rowspan="1">LDIR.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56447"></span>56447</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">HL</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56448"></span>56448</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash <span class="register">HL</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56449"></span>56449</td>
<td class="instruction">LD (HL),C</td>
<td class="comment-1" rowspan="1">Write <span class="register">C</span> to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56450"></span>56450</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore <span class="register">DE</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56451"></span>56451</td>
<td class="instruction">DEC DE</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">DE</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56452"></span>56452</td>
<td class="instruction">LD BC,3</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=0003.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56455"></span>56455</td>
<td class="instruction">LDDR</td>
<td class="comment-1" rowspan="1">LDDR.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56457"></span>56457</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="2">Restore <span class="register">DE</span> and <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56458"></span>56458</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56459"></span>56459</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Move to the next pixel row in the destination address.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56460"></span>56460</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Move to the next pixel row in the source address.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56461"></span>56461</td>
<td class="instruction">LD BC,4</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=0004.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56464"></span>56464</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrease the pixel row counter by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56465"></span>56465</td>
<td class="instruction">JP NZ,<a href="56395.html#56443">MoveTile_Down_PixelShift</a></td>
<td class="comment-1" rowspan="1">Jump back to <a href="56395.html#56443">MoveTile_Down_PixelShift</a> until all pixels in the row have been moved.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56468"></span>56468</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56469"></span>56469</td>
<td class="instruction">CALL <a href="56529.html">Calculate_AttributeAddress</a></td>
<td class="comment-1" rowspan="1">Call <a href="56529.html">Calculate_AttributeAddress</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="56472"></span>
<div class="comments">
<div class="paragraph">
Move <span class="register">DE</span> down one attribute row.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56472"></span>56472</td>
<td class="instruction">LD HL,32</td>
<td class="comment-1" rowspan="3"><span class="register">DE</span>+=0032.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56475"></span>56475</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56476"></span>56476</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56477"></span>56477</td>
<td class="instruction">LD BC,4</td>
<td class="comment-1" rowspan="2">Copy 0004 attribute bytes from .</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56480"></span>56480</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56482"></span>56482</td>
<td class="instruction">LD BC,3</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=0003.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56485"></span>56485</td>
<td class="instruction">LD A,71</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=INK:
WHITE,
PAPER:
BLACK
(BRIGHT)
.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56487"></span>56487</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">HL</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56488"></span>56488</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56489"></span>56489</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash <span class="register">HL</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56490"></span>56490</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore <span class="register">DE</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56491"></span>56491</td>
<td class="instruction">DEC DE</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">DE</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56492"></span>56492</td>
<td class="instruction">LDDR</td>
<td class="comment-1" rowspan="1">LDDR.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56494"></span>56494</td>
<td class="instruction">LD HL,59231</td>
<td class="comment-1" rowspan="2">Decrease *<a href="59229.html#59231">Tile_Horizontal_Coordinate</a> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56497"></span>56497</td>
<td class="instruction">DEC (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56498"></span>56498</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the pixel row counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56499"></span>56499</td>
<td class="instruction">DJNZ <a href="56395.html#56417">MoveTile_Down_RowLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the pixel row counter by one and loop back to <a href="56395.html#56417">MoveTile_Down_RowLoop</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56501"></span>56501</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="2">Restore the row counter from the stack for the sound generator, but keep a copy of it back on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56502"></span>56502</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56503"></span>56503</td>
<td class="instruction">CALL <a href="56658.html">Sound_TileMovement</a></td>
<td class="comment-1" rowspan="1">Call <a href="56658.html">Sound_TileMovement</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56506"></span>56506</td>
<td class="instruction">LD HL,59229</td>
<td class="comment-1" rowspan="2">Increment *<a href="59229.html">Tile_Horizontal_Position</a> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56509"></span>56509</td>
<td class="instruction">INC (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56510"></span>56510</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the number of spaces left to move from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56511"></span>56511</td>
<td class="instruction">DJNZ <a href="56395.html#56406">MoveTile_Down_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease the number of spaces counter by one and loop back to <a href="56395.html#56406">MoveTile_Down_Loop</a> until the tile is in the destination space.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="56513"></span>56513</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="56293.html">56293</a>
</td>
<td class="up">Up: <a href="../maps/all.html#56395">Map</a></td>
<td class="next">
Next: <a href="56514.html">56514</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1986 Domark Ltd &copy; 2024 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.4.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/splittingimages/">Source code</a>.</div>
<div><a href="../../asm/DC4B.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>