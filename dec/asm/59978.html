<!DOCTYPE html>
<html>
<head>
<title>Splitting Images: Routine at 59978</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="59951.html">59951</a>
</td>
<td class="up">Up: <a href="../maps/all.html#59978">Map</a></td>
<td class="next">
Next: <a href="60214.html">60214</a>
</td>
</tr>
</table>
<div class="description">59978: Handler: Main Menu</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="53712.html">Game_Loop</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59978"></span>
<div class="comments">
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="main-menu-cursor" src="../../images/scr/main-menu-cursor.png" /></td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_MainMenu</td>
<td class="address-2"><span id="59978"></span>59978</td>
<td class="instruction">LD DE,55412</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="55412.html">Score_Digit_01</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59981"></span>59981</td>
<td class="instruction">LD HL,55407</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="55407.html">HighScore</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59984"></span>59984</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Load the first byte of the current score.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59985"></span>59985</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-1" rowspan="1">Compare it with the first byte of the high score.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59986"></span>59986</td>
<td class="instruction">JP M,<a href="59978.html#60002">Print_Score/HighScore</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="59978.html#60002">Print_Score/HighScore</a> if the current score digit is less than the high score digit.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59989"></span>
<div class="comments">
<div class="paragraph">
It's a new high score! Update what's stored.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59989"></span>59989</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="2">Write the first score digit to the first highscore digit.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59990"></span>59990</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59991"></span>59991</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Increment the current score pointer by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59992"></span>59992</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment the high score pointer by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59993"></span>59993</td>
<td class="instruction">JR NZ,<a href="59978.html#60000">UpdateHighScore</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="59978.html#60000">UpdateHighScore</a> until the score digit is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59995"></span>59995</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Load the second byte of the current score.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59996"></span>59996</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-1" rowspan="1">Compare it with the second byte of the high score.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="59997"></span>59997</td>
<td class="instruction">JP M,<a href="59978.html#60002">Print_Score/HighScore</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="59978.html#60002">Print_Score/HighScore</a> if the current score digit is less than the high score digit.</td>
</tr>
<tr>
<td class="asm-label">UpdateHighScore</td>
<td class="address-2"><span id="60000"></span>60000</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="2">Write the second score digit to the second highscore digit.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60001"></span>60001</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60002"></span>
<div class="comments">
<div class="paragraph">
Print the score of the last game and the high score.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Print_Score/HighScore</td>
<td class="address-2"><span id="60002"></span>60002</td>
<td class="instruction">LD B,19</td>
<td class="comment-1" rowspan="1">Set the X co-ordinate for the score display.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60004"></span>60004</td>
<td class="instruction">LD C,14</td>
<td class="comment-1" rowspan="1">Set the Y co-ordinate for the score display.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60006"></span>60006</td>
<td class="instruction">LD DE,55412</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="55412.html">Score_Digit_01</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60009"></span>60009</td>
<td class="instruction">LD A,6</td>
<td class="comment-1" rowspan="1">Set the number of digits to print in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60011"></span>60011</td>
<td class="instruction">CALL <a href="56110.html">Print_Numbers</a></td>
<td class="comment-1" rowspan="1">Call <a href="56110.html">Print_Numbers</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60014"></span>60014</td>
<td class="instruction">LD B,21</td>
<td class="comment-1" rowspan="1">Set the X co-ordinate for the high score display.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60016"></span>60016</td>
<td class="instruction">LD C,14</td>
<td class="comment-1" rowspan="1">Set the Y co-ordinate for the high score display.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60018"></span>60018</td>
<td class="instruction">LD DE,55407</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="55407.html">HighScore</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60021"></span>60021</td>
<td class="instruction">LD A,6</td>
<td class="comment-1" rowspan="1">Set the number of digits to print in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60023"></span>60023</td>
<td class="instruction">CALL <a href="56110.html">Print_Numbers</a></td>
<td class="comment-1" rowspan="1">Call <a href="56110.html">Print_Numbers</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60026"></span>
<div class="comments">
<div class="paragraph">
Initialise the cursor/ pointer which highlights the currently selected menu item.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60026"></span>60026</td>
<td class="instruction">LD IX,(55415)</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=*<a href="55415.html">SelectedMenuItem_ScreenPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60030"></span>60030</td>
<td class="instruction">LD HL,60216</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="60216.html">SelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60033"></span>60033</td>
<td class="instruction">JR <a href="59978.html#60135">HighlightSelectedMenuItem</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="59978.html#60135">HighlightSelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60035"></span>
<div class="comments">
<div class="paragraph">
Maybe a debounce loop?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Debounce_Loop</td>
<td class="address-2"><span id="60035"></span>60035</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Get the player input from ALL half-rows (i.e. all the keys).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60036"></span>60036</td>
<td class="instruction">IN A,(254)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60038"></span>60038</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="1">Invert the bits in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60039"></span>60039</td>
<td class="instruction">AND %00011111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-4.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60041"></span>60041</td>
<td class="instruction">JR NZ,<a href="59978.html#60035">Debounce_Loop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="59978.html#60035">Debounce_Loop</a> if <span class="register">HL</span> is not zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60043"></span>
<div class="comments">
<div class="paragraph">
Get the player input.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MainMenuInput_Loop</td>
<td class="address-2"><span id="60043"></span>60043</td>
<td class="instruction">LD A,247</td>
<td class="comment-1" rowspan="2">Read from the keyboard; <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">247</td>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="centre" colspan="1" rowspan="1">5</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60045"></span>60045</td>
<td class="instruction">IN A,(254)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60047"></span>60047</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="1">Invert the bits in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60048"></span>60048</td>
<td class="instruction">AND %00011111</td>
<td class="comment-1" rowspan="1">Mask for the key bits.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60050"></span>60050</td>
<td class="instruction">JR Z,<a href="59978.html#60043">MainMenuInput_Loop</a></td>
<td class="comment-1" rowspan="1">Jump back to <a href="59978.html#60043">MainMenuInput_Loop</a> if no keys are being pressed.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60052"></span>
<div class="comments">
<div class="paragraph">
Check which key was pressed and handle accordingly.
</div>
<div class="paragraph">
Handle "KEYBOARD" being selected.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60052"></span>60052</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="2">Jump to <a href="59978.html#60072">MainMenuInput_Kempston</a> if "1" was not pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60053"></span>60053</td>
<td class="instruction">JR NC,<a href="59978.html#60072">MainMenuInput_Kempston</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60055"></span>60055</td>
<td class="instruction">LD A,1</td>
<td class="comment-1" rowspan="3">Jump back to <a href="59978.html#60035">Debounce_Loop</a> if this menu item is already selected.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60057"></span>60057</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60058"></span>60058</td>
<td class="instruction">JR Z,<a href="59978.html#60035">Debounce_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60060"></span>60060</td>
<td class="instruction">CALL <a href="59978.html#60157">ClearSelectedMenuItem</a></td>
<td class="comment-1" rowspan="1">Call <a href="59978.html#60157">ClearSelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60063"></span>60063</td>
<td class="instruction">LD IX,22595</td>
<td class="comment-1" rowspan="1">Set the screen position for this option in <span class="register">IX</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60067"></span>60067</td>
<td class="instruction">LD DE,60260</td>
<td class="comment-1" rowspan="1">Set the address of the input control routine for this option in <span class="register">DE</span> (<a href="60260.html">InputHandler_Keyboard</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60070"></span>60070</td>
<td class="instruction">JR <a href="59978.html#60130">UpdateMenuSelection</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="59978.html#60130">UpdateMenuSelection</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60072"></span>
<div class="comments">
<div class="paragraph">
Handle "KEMPSTON" being selected.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MainMenuInput_Kempston</td>
<td class="address-2"><span id="60072"></span>60072</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="2">Jump to <a href="59978.html#60092">MainMenuInput_Cursor</a> if "2" was not pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60073"></span>60073</td>
<td class="instruction">JR NC,<a href="59978.html#60092">MainMenuInput_Cursor</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60075"></span>60075</td>
<td class="instruction">LD A,2</td>
<td class="comment-1" rowspan="3">Jump back to <a href="59978.html#60035">Debounce_Loop</a> if this menu item is already selected.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60077"></span>60077</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60078"></span>60078</td>
<td class="instruction">JR Z,<a href="59978.html#60035">Debounce_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60080"></span>60080</td>
<td class="instruction">CALL <a href="59978.html#60157">ClearSelectedMenuItem</a></td>
<td class="comment-1" rowspan="1">Call <a href="59978.html#60157">ClearSelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60083"></span>60083</td>
<td class="instruction">LD IX,22691</td>
<td class="comment-1" rowspan="1">Set the screen position for this option in <span class="register">IX</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60087"></span>60087</td>
<td class="instruction">LD DE,60312</td>
<td class="comment-1" rowspan="1">Set the address of the input control routine for this option in <span class="register">DE</span> (<a href="60312.html">InputHandler_Kempston</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60090"></span>60090</td>
<td class="instruction">JR <a href="59978.html#60130">UpdateMenuSelection</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="59978.html#60130">UpdateMenuSelection</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60092"></span>
<div class="comments">
<div class="paragraph">
Handle "CURSOR" being selected.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MainMenuInput_Cursor</td>
<td class="address-2"><span id="60092"></span>60092</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="2">Jump to <a href="59978.html#60112">MainMenuInput_Sinclair</a> if "3" was not pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60093"></span>60093</td>
<td class="instruction">JR NC,<a href="59978.html#60112">MainMenuInput_Sinclair</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60095"></span>60095</td>
<td class="instruction">LD A,3</td>
<td class="comment-1" rowspan="3">Jump back to <a href="59978.html#60035">Debounce_Loop</a> if this menu item is already selected.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60097"></span>60097</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60098"></span>60098</td>
<td class="instruction">JR Z,<a href="59978.html#60035">Debounce_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60100"></span>60100</td>
<td class="instruction">CALL <a href="59978.html#60157">ClearSelectedMenuItem</a></td>
<td class="comment-1" rowspan="1">Call <a href="59978.html#60157">ClearSelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60103"></span>60103</td>
<td class="instruction">LD IX,22787</td>
<td class="comment-1" rowspan="1">Set the screen position for this option in <span class="register">IX</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60107"></span>60107</td>
<td class="instruction">LD DE,60318</td>
<td class="comment-1" rowspan="1">Set the address of the input control routine for this option in <span class="register">DE</span> (<a href="60318.html">InputHandler_Cursor</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60110"></span>60110</td>
<td class="instruction">JR <a href="59978.html#60130">UpdateMenuSelection</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="59978.html#60130">UpdateMenuSelection</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60112"></span>
<div class="comments">
<div class="paragraph">
Handle "SINCLAIR" being selected.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MainMenuInput_Sinclair</td>
<td class="address-2"><span id="60112"></span>60112</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="2">Jump to <a href="59978.html#60174">MainMenuInput_StartGame</a> if "4" was not pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60113"></span>60113</td>
<td class="instruction">JR NC,<a href="59978.html#60174">MainMenuInput_StartGame</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60115"></span>60115</td>
<td class="instruction">LD A,4</td>
<td class="comment-1" rowspan="3">Jump back to <a href="59978.html#60035">Debounce_Loop</a> if this menu item is already selected.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60117"></span>60117</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60118"></span>60118</td>
<td class="instruction">JR Z,<a href="59978.html#60035">Debounce_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60120"></span>60120</td>
<td class="instruction">CALL <a href="59978.html#60157">ClearSelectedMenuItem</a></td>
<td class="comment-1" rowspan="1">Call <a href="59978.html#60157">ClearSelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60123"></span>60123</td>
<td class="instruction">LD IX,22883</td>
<td class="comment-1" rowspan="1">Set the screen position for this option in <span class="register">IX</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60127"></span>60127</td>
<td class="instruction">LD DE,60365</td>
<td class="comment-1" rowspan="1">Set the address of the input control routine for this option in <span class="register">DE</span> (<a href="60365.html">InputHandler_Sinclair</a>).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60130"></span>
<div class="comments">
<div class="paragraph">
Update menu selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">UpdateMenuSelection</td>
<td class="address-2"><span id="60130"></span>60130</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write the selected menu item to *<a href="60216.html">SelectedMenuItem</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60131"></span>60131</td>
<td class="instruction">LD (60214),DE</td>
<td class="comment-1" rowspan="1">Write the address of the input control routine to *<a href="60214.html">Pointer_InputControl</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60135"></span>
<div class="comments">
<div class="paragraph">
Point to selected menu item.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">HighlightSelectedMenuItem</td>
<td class="address-2"><span id="60135"></span>60135</td>
<td class="instruction">LD (IX+0),69</td>
<td class="comment-1" rowspan="2">Write INK:
CYAN,
PAPER:
BLACK
(BRIGHT)
 to: <table class="default">
<tr>
<th colspan="1" rowspan="1">Offset</th>
<th colspan="1" rowspan="1">Position</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+0</td>
<td class="centre" colspan="1" rowspan="1">Top-left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+1</td>
<td class="centre" colspan="1" rowspan="1">Top-right</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60139"></span>60139</td>
<td class="instruction">LD (IX+1),69</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60143"></span>60143</td>
<td class="instruction">LD (IX+32),5</td>
<td class="comment-1" rowspan="2">Write INK:
CYAN,
PAPER:
BLACK

 to: <table class="default">
<tr>
<th colspan="1" rowspan="1">Offset</th>
<th colspan="1" rowspan="1">Position</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+32</td>
<td class="centre" colspan="1" rowspan="1">Bottom-left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+33</td>
<td class="centre" colspan="1" rowspan="1">Bottom-right</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60147"></span>60147</td>
<td class="instruction">LD (IX+33),5</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60151"></span>60151</td>
<td class="instruction">LD (55415),IX</td>
<td class="comment-1" rowspan="1">Write <span class="register">IX</span> to <a href="55415.html">SelectedMenuItem_ScreenPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60155"></span>60155</td>
<td class="instruction">JR <a href="59978.html#60035">Debounce_Loop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="59978.html#60035">Debounce_Loop</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60157"></span>
<div class="comments">
<div class="paragraph">
Clear previous selected menu item.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">ClearSelectedMenuItem</td>
<td class="address-2"><span id="60157"></span>60157</td>
<td class="instruction">LD (IX+0),0</td>
<td class="comment-1" rowspan="4">Write INK:
BLACK,
PAPER:
BLACK

 to: <table class="default">
<tr>
<th colspan="1" rowspan="1">Offset</th>
<th colspan="1" rowspan="1">Position</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+0</td>
<td class="centre" colspan="1" rowspan="1">Top-left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+1</td>
<td class="centre" colspan="1" rowspan="1">Top-right</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+32</td>
<td class="centre" colspan="1" rowspan="1">Bottom-left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">*<span class="register">IX</span>+33</td>
<td class="centre" colspan="1" rowspan="1">Bottom-right</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60161"></span>60161</td>
<td class="instruction">LD (IX+1),0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60165"></span>60165</td>
<td class="instruction">LD (IX+32),0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60169"></span>60169</td>
<td class="instruction">LD (IX+33),0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60173"></span>60173</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60174"></span>
<div class="comments">
<div class="paragraph">
Note; there's no need for the "not pressed" check, as there are only five options.
</div>
<div class="paragraph">
Handle "START GAME" being selected.
</div>
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="good-luck" src="../../images/scr/good-luck.png" /></td>
</tr>
</table>
</div>
<div class="paragraph">
Uncover the "Good Luck" messaging (it's already present, just black on black).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MainMenuInput_StartGame</td>
<td class="address-2"><span id="60174"></span>60174</td>
<td class="instruction">LD HL,23094</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=23094 (attribute buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60177"></span>60177</td>
<td class="instruction">LD DE,32</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=0032.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60180"></span>60180</td>
<td class="instruction">LD B,4</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> for the number of rows to process.</td>
</tr>
<tr>
<td class="asm-label">GoodLuck_OuterLoop</td>
<td class="address-2"><span id="60182"></span>60182</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash the row counter on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60183"></span>60183</td>
<td class="instruction">LD B,8</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> for the width of the messaging.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60185"></span>60185</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash the starting position in the attribute buffer on the stack.</td>
</tr>
<tr>
<td class="asm-label">GoodLuck_InnerLoop</td>
<td class="address-2"><span id="60186"></span>60186</td>
<td class="instruction">LD (HL),71</td>
<td class="comment-1" rowspan="1">Write INK:
WHITE,
PAPER:
BLACK
(BRIGHT)
 to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60188"></span>60188</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment attribute buffer screen position by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60189"></span>60189</td>
<td class="instruction">DJNZ <a href="59978.html#60186">GoodLuck_InnerLoop</a></td>
<td class="comment-1" rowspan="1">Decrease width counter by one and loop back to <a href="59978.html#60186">GoodLuck_InnerLoop</a> until all the width has been coloured.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60191"></span>60191</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the attribute buffer starting position from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60192"></span>60192</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>+=0032 (move down one row).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60193"></span>60193</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the row counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60194"></span>60194</td>
<td class="instruction">DJNZ <a href="59978.html#60182">GoodLuck_OuterLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the row counter by one and loop back to <a href="59978.html#60182">GoodLuck_OuterLoop</a> until the row counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60196"></span>60196</td>
<td class="instruction">LD HL,60217</td>
<td class="comment-1" rowspan="2">Write 1 to <a href="60217.html">60217</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60199"></span>60199</td>
<td class="instruction">LD (HL),1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60201"></span>60201</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash <a href="60217.html">60217</a> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60202"></span>60202</td>
<td class="instruction">LD HL,60218</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="60218.html">60218</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60205"></span>60205</td>
<td class="instruction">LD B,14</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=14.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60207"></span>60207</td>
<td class="instruction">CALL <a href="61258.html">61258</a></td>
<td class="comment-1" rowspan="1">Call <a href="61258.html">61258</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60210"></span>60210</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60211"></span>60211</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-1" rowspan="1">Write 0 to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="60213"></span>60213</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="59951.html">59951</a>
</td>
<td class="up">Up: <a href="../maps/all.html#59978">Map</a></td>
<td class="next">
Next: <a href="60214.html">60214</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1986 Domark Ltd &copy; 2024 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.4.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/splittingimages/">Source code</a>.</div>
<div><a href="../../asm/EA4A.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>